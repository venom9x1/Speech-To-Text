<!DOCTYPE html>
<html lang="en">
    <head>
        <title> Convert Speech To text (Video-> Text)</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
            <meta charset="utf-8">
                <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
                    
                    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
                        
                        <!--                        <link rel="stylesheet" href="https://cdn.webrtc-experiment.com/style.css">-->
                        <style>
                            tr, td, th {
                                vertical-align: top;
                                padding: .7em 1.4em;
                                border-top: 1px dotted #BBA9A9;
                                border-right: 1px dotted #BBA9A9;
                            }
                        .section-divider {
                            display: inline-block;
                            width: 100%;
                            border: 0px outset black;
                            padding: 5px 10px;
                            vertical-align: top;
                            height: 500px;
                        }
                        
                        .section-divider * {
                            padding: 0;
                            margin: 0;
                        }
                        
                        .section-divider h2 {
                            font-size: 2em;
                            border-bottom: 2px outset black;
                            margin-bottom: 15px;
                            margin-left: -10px;
                            margin-right: -10px;
                            padding: 0 10px;
                            text-align: center;
                        }
                        
                        .section-divider textarea {
                            width: 90%;
                            height: 250px;
                            resize: none;
                            font-size: 2em;
                            padding: 5px 10px;
                        }
                        
                        select {
                            height: auto;
                            vertical-align: middle;
                            font-size: inherit;
                        }
                        
                        button, input[type=button] {
                            padding: 0 5px!important;
                        }
                        </style>
                        
                        <style type="text/css">
                            .strt_btn { cursor: pointer; border: #053d5d solid 0px; width:172px; height:55px; background: url('../images/rec_start.png') repeat scroll 0 0 transparent; }
                            .stp_btn { cursor: pointer; border: #053d5d solid 0px; width:172px; height:70px; background: url('../images/rec_stop.png') no-repeat fixed;/*repeat scroll 0 0 transparent;*/ }
                            #recFile { margin: 0px 0px 0px 0px; border: 0px solid #FFF; }
                            
                            #recordingStatus { height: 50px; font-weight: bold; font-size: 20px; text-align: center; }
                            #waveDiv { margin: 0px 0px 0px 0px; border: 0px solid #FFF;}
                            #wavedisplay { display: inline-block; background-color: #f3f3f3; width: 90%; height: 40px;margin: 5px; box-shadow: 1px 1px 10px 2px #dddddd;}
                            
                            #audioCtrls, #audioCtrlMsg { display: none; }
                            #audioCtrls td { height: 230px; vertical-align: top; }
                            #audioCtrls .recordedFile { font-size: 11px; padding: 3px 1px 12px 1px; }
                            #audioCtrls .note { font-size: 10px; }
                            </style>
                        </head>
    
    <body>
      
        <table width="100%" border="0" cellpadding="0" cellspacing="1">
            <tbody>
                <tr>
                    <td>
                        <div class="qChs">
                            <div class="qAnsNote" id="recordingStatus">
                                Live Transcribing (English/Hindi)
                                <p class="no-mobile">
                                
                                </p>
                            </div>
                            <table width="100%" border="0" cellpadding="0" cellspacing="3">
                               
                                            
                                <tr colspan="2">
                                    <td colspan="2">
                                        
                                        
                                        <section class="section-divider">
                                            
                                            
                                            <textarea id="textarea-from"></textarea><br>
                                            <button id="btn-convert-text" style="font-size: 16px;color: white;display:none;">Convert Your Text Input</button><br>
                                            <button id="btn-convert-voice" style="font-size: 16px;color: white;display:none;">Speak & Convert Your Voice</button>
                                                </section>
                                                </td>
                                    <td colspan="2" style="
                                        align-items: center;
                                        text-align: center;
                                        
                                        ">
                                        
                                        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
                                            <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
                                            <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
                                            <script src="https://cdn.webrtc-experiment.com/RecordRTC.js"></script>
                                            <script src="https://webrtc.github.io/adapter/adapter-latest.js"></script>
                                            <script src="https://cdn.webrtc-experiment.com/DetectRTC.js"> </script>
                                            <link href="https://cdn.webrtc-experiment.com/getHTMLMediaElement.css" rel="stylesheet">
                                                <script src="https://cdn.webrtc-experiment.com/getHTMLMediaElement.js"></script>
                                                
                                                <article style="
                                                    border: none;
                                                    ">
                                                    <section >
                                                        <div style="text-align:center;">Select Language
                                                            <select id="convert-from" >
                                                                <option>en (English)</option>
                                                                <option>hi (हिंदी)</option>
                                                            </select>
                                                        </div>
                                                        <div style="margin-top: 10px;" id="recording-player"></div>
                                                        <h2 class="header" style="margin: 0;border-bottom:none;">
                                                            <select class="recording-media"  style="display:none;">
                                                                <option value="record-audio-plus-video">Microphone+Camera</option>
                                                            </select>
                                                            <select class="media-container-format" style="display:none;">
                                                                <option>default</option>
                                                            </select>
                                                            <br>
                                                            <input class="btn btn-primary"  type="button" id="btn-start-recording" value="Start Recording"
                                                                style="font-size: 0.6em;">
                                                                <input class="btn btn-primary" type="button" id="open-new-tab" value="Preview" style="display: none;font-size: 0.6em;"
                                                                    >
                                                                        <select class="media-resolutions" style="display:none;">
                                                                            <option value="default">Default resolutions</option>
                                                                        </select>
                                                                        
                                                                        <select class="media-framerates" style="display:none;">
                                                                            <option value="default">Default framerates</option>
                                                                        </select>
                                                                        
                                                                        <select class="media-bitrates" style="display:none;">
                                                                            <option value="default">Default bitrates</option>
                                                                        </select>
                                                                        </h2>
                                                        
                                                    </section>
                                                    <script src="https://cdn.webrtc-experiment.com/Translator.js"></script>
                                                    
                                                    <script>
                                                        function leaveChange(control) {
                                                            debugger;
                                                            var convertFrom = document.getElementById('convert-from');
                                                            var languages = getLanguages();
                                                            translator.voiceToText(function(text) {
                                                                                   textareaFrom.value = text;
                                                                                   
                                                                                   //   document.getElementById('btn-convert-text').onclick(true);
                                                                                   this.disabled = false;
                                                                                   }, languages.from);
                                                        }
                                                    
                                                    var translator = new Translator();
                                                    
                                                    function getOption(language) {
                                                        var option = document.createElement('option');
                                                        option.value = language.language;
                                                        if(language.name) {
                                                            option.innerHTML = language.name + ' (' + language.language + ')'
                                                        }
                                                        else {
                                                            option.innerHTML = language.language;
                                                        }
                                                        
                                                        if(language.language == 'en') {
                                                            option.selected = true;
                                                        }
                                                        
                                                        return option;
                                                    }
                                                    
                                                    var convertFrom = document.getElementById('convert-from');
                                                    //  var convertInto = document.getElementById('convert-into');
                                                    
                                                    
                                                    
                                                    var textareaFrom = document.getElementById('textarea-from');
                                                    <!--        var textareaTo = document.getElementById('textarea-to');-->
                                                    
                                                    function getLanguages() {
                                                        var from = document.getElementById('convert-from').value.split(' (')[0];
                                                        //  var to = document.getElementById('convert-into').value.split(' (')[0];
                                                        
                                                        return {
                                                            from: from
                                                            //    to: to
                                                        };
                                                    }
                                                    
                                                    document.getElementById('btn-convert-voice').onclick = function() {
                                                        this.disabled = true;
                                                        this.innerHTML = 'Start Speaking!';
                                                        this.style="color:'black'";
                                                        var languages = getLanguages();
                                                        
                                                        translator.voiceToText(function(text) {
                                                                               textareaFrom.value = text;
                                                                               
                                                                               //   document.getElementById('btn-convert-text').onclick(true);
                                                                               this.disabled = false;
                                                                               }, languages.from);
                                                    };
                                                    
                                                    
                                                    
                                                    
                                                    textareaFrom.onchange = function() {
                                                        localStorage.setItem('textarea-from', this.value);
                                                    };
                                                    
                                                    if(localStorage.getItem('textarea-from')) {
                                                        textareaFrom.value = localStorage.getItem('textarea-from');
                                                    }
                                                    
                                                    
                                                    <!--        localStorageGetItem();-->
                                                        </script>
                                                    
                                                    <!-- commits.js is useless for you! -->
                                                    <script src="https://cdn.webrtc-experiment.com/Translator.js"></script>
                                                    <script>
                                                        $(document).ready(function () {
                                                                          $($('#xinner').find('.top_menu').get(0)).hide();
                                                                          function onCaps(e, on) {
                                                                          if (on)
                                                                          $('#pnlIndicator').addClass('on');
                                                                          else
                                                                          $('#pnlIndicator').removeClass('on');
                                                                          }
                                                                          
                                                                          $("body").bind("contextmenu", function (e) {
                                                                                         e.preventDefault();
                                                                                         });
                                                                          $("body").bind("copy paste cut drag drop", function (e) {
                                                                                         e.preventDefault();
                                                                                         });
                                                                          $("body").bind("keydown keyup keypress", function (e) {
                                                                                         //alert(e.keyCode);
                                                                                         if (e.keyCode === 17 || e.keyCode === 123 || e.keyCode === 116 || e.keyCode === 82
                                                                                             || e.keyCode === 36 || e.keyCode === 40 || e.keyCode === 41
                                                                                             || e.keyCode === 46 || e.keyCode === 39 || e.keyCode === 60 || e.keyCode === 62
                                                                                             || e.keyCode === 191 || e.keyCode === 220) {
                                                                                         e.preventDefault();
                                                                                         }
                                                                                         });
                                                                          
                                                                          $('#oldPassword, #newPassword, #confirmPassword').capsChecker({capson: onCaps, capsoff: onCaps});
                                                                          });
                                                                          
                                                                          (function() {
                                                                           var params = {},
                                                                           r = /([^&=]+)=?([^&]*)/g;
                                                                           
                                                                           function d(s) {
                                                                           return decodeURIComponent(s.replace(/\+/g, ' '));
                                                                           }
                                                                           
                                                                           var match, search = window.location.search;
                                                                           while (match = r.exec(search.substring(1))) {
                                                                           params[d(match[1])] = d(match[2]);
                                                                           
                                                                           if(d(match[2]) === 'true' || d(match[2]) === 'false') {
                                                                           params[d(match[1])] = d(match[2]) === 'true' ? true : false;
                                                                           }
                                                                           }
                                                                           
                                                                           window.params = params;
                                                                           })();
                                                                           
                                                                           function addStreamStopListener(stream, callback) {
                                                                               var streamEndedEvent = 'ended';
                                                                               
                                                                               if ('oninactive' in stream) {
                                                                                   streamEndedEvent = 'inactive';
                                                                               }
                                                                               
                                                                               stream.addEventListener(streamEndedEvent, function() {
                                                                                                       callback();
                                                                                                       callback = function() {};
                                                                                                       }, false);
                                                                                                       
                                                                                                       stream.getAudioTracks().forEach(function(track) {
                                                                                                                                       track.addEventListener(streamEndedEvent, function() {
                                                                                                                                                              callback();
                                                                                                                                                              callback = function() {};
                                                                                                                                                              }, false);
                                                                                                                                       });
                                                                                                                                       
                                                                                                                                       stream.getVideoTracks().forEach(function(track) {
                                                                                                                                                                       track.addEventListener(streamEndedEvent, function() {
                                                                                                                                                                                              callback();
                                                                                                                                                                                              callback = function() {};
                                                                                                                                                                                              }, false);
                                                                                                                                                                       });
                                                                           }
                                                    </script>
                                                    
                                                    <script>
                                                        var executed = false;
                                                        function startSpeech(){
                                                            if(executed !==true){
                                                                var languages = getLanguages();
                                                                
                                                                translator.voiceToText(function(text) {
                                                                                       textareaFrom.value =textareaFrom.value +" \n" + text;
                                                                                       
                                                                                       //   document.getElementById('btn-convert-text').onclick(true);
                                                                                       
                                                                                       }, languages.from);
                                                                                       executed = true;
                                                                                       
                                                            }
                                                            
                                                        }
                                                    
                                                    
                                                    var video = document.createElement('video');
                                                    video.controls = false;
                                                    var mediaElement = getHTMLMediaElement(video, {
                                                                                           title: 'Recording status: click start recording',
                                                                                           buttons: ['full-screen'/*, 'take-snapshot'*/],
                                                                                           showOnMouseEnter: false,
                                                                                           width: 360,
                                                                                           onTakeSnapshot: function() {
                                                                                           var canvas = document.createElement('canvas');
                                                                                           canvas.width = mediaElement.clientWidth;
                                                                                           canvas.height = mediaElement.clientHeight;
                                                                                           
                                                                                           var context = canvas.getContext('2d');
                                                                                           context.drawImage(recordingPlayer, 0, 0, canvas.width, canvas.height);
                                                                                           
                                                                                           window.open(canvas.toDataURL('image/png'));
                                                                                           }
                                                                                           });
                                                                                           document.getElementById('recording-player').appendChild(mediaElement);
                                                                                           
                                                                                           var div = document.createElement('section');
                                                                                           mediaElement.media.parentNode.appendChild(div);
                                                                                           div.appendChild(mediaElement.media);
                                                                                           
                                                                                           var recordingPlayer = mediaElement.media;
                                                                                           var recordingMedia = document.querySelector('.recording-media');
                                                                                           var mediaContainerFormat = document.querySelector('.media-container-format');
                                                                                           var mimeType = 'video/webm';
                                                                                           var fileExtension = 'webm';
                                                                                           var type = 'video';
                                                                                           var recorderType;
                                                                                           var defaultWidth;
                                                                                           var defaultHeight;
                                                                                           
                                                                                           var btnStartRecording = document.querySelector('#btn-start-recording');
                                                                                           
                                                                                           window.onbeforeunload = function() {
                                                                                               btnStartRecording.disabled = false;
                                                                                               recordingMedia.disabled = false;
                                                                                               mediaContainerFormat.disabled = false;
                                                                                               alert("2");
                                                                                           };
                                                    btnStartRecording.onclick = function(event) {
                                                        startSpeech();
                                                        var button = btnStartRecording;
                                                        if(button.innerHTML === 'Stop Recording' || button.value === 'Stop Recording' ) {
                                                            
                                                            button.disabled = true;
                                                            button.disableStateWaiting = true;
                                                            setTimeout(function() {
                                                                       button.disabled = false;
                                                                       button.disableStateWaiting = false;
                                                                       
                                                                       }, 2000);
                                                                       
                                                                       document.getElementById("btn-start-recording").value="Start Recording";
                                                                       button.innerHTML = 'Start Recording';
                                                                       
                                                                       function stopStream() {
                                                                           if(button.stream && button.stream.stop) {
                                                                               button.stream.stop();
                                                                               button.stream = null;
                                                                           }
                                                                           
                                                                           if(button.stream instanceof Array) {
                                                                               button.stream.forEach(function(stream) {
                                                                                                     stream.stop();
                                                                                                     });
                                                                                                     button.stream = null;
                                                                           }
                                                                           
                                                                           videoBitsPerSecond = null;
                                                                           var html = 'Recording status: stopped';
                                                                           /*   html += '<br>Size: ' + bytesToSize(button.recordRTC.getBlob().size); */
                                                                           recordingPlayer.parentNode.parentNode.querySelector('h2').innerHTML = html;
                                                                       }
                                                                       
                                                                       if(button.recordRTC) {
                                                                           if(button.recordRTC.length) {
                                                                               button.recordRTC[0].stopRecording(function(url) {
                                                                                                                 if(!button.recordRTC[1]) {
                                                                                                                 button.recordingEndedCallback(url);
                                                                                                                 stopStream();
                                                                                                                 
                                                                                                                 saveToDiskOrOpenNewTab(button.recordRTC[0]);
                                                                                                                 return;
                                                                                                                 }
                                                                                                                 
                                                                                                                 button.recordRTC[1].stopRecording(function(url) {
                                                                                                                                                   button.recordingEndedCallback(url);
                                                                                                                                                   stopStream();
                                                                                                                                                   });
                                                                                                                 });
                                                                           }
                                                                           else {
                                                                               button.recordRTC.stopRecording(function(url) {
                                                                                                              if(button.blobs && button.blobs.length) {
                                                                                                              var blob = new File(button.blobs, getFileName(fileExtension), {
                                                                                                                                  type: mimeType
                                                                                                                                  });
                                                                                                              
                                                                                                              button.recordRTC.getBlob = function() {
                                                                                                              return blob;
                                                                                                              };
                                                                                                              
                                                                                                              url = URL.createObjectURL(blob);
                                                                                                              }
                                                                                                              
                                                                                                              button.recordingEndedCallback(url);
                                                                                                              saveToDiskOrOpenNewTab(button.recordRTC);
                                                                                                              stopStream();
                                                                                                              });
                                                                           }
                                                                       }
                                                                       
                                                                       return;
                                                        }
                                                        
                                                        if(!event) return;
                                                        
                                                        button.disabled = true;
                                                        
                                                        var commonConfig = {
                                                            onMediaCaptured: function(stream) {
                                                                button.stream = stream;
                                                                if(button.mediaCapturedCallback) {
                                                                    button.mediaCapturedCallback();
                                                                }
                                                                $('#save-to-disk').hide();
                                                                $('#open-new-tab').hide();
                                                                $('#qNavigation').hide();
                                                                $('#btnNext').hide();
                                                                $('#btnPrev').hide();
                                                                $('#btnFinish').hide();
                                                                $('#btnClear').hide();
                                                                document.getElementById("btn-start-recording").value="Stop Recording";
                                                                
                                                                button.innerHTML = 'Stop Recording';
                                                                button.disabled = false;
                                                                
                                                            },
                                                            onMediaStopped: function() {
                                                                $('#save-to-disk').hide();
                                                                $('#open-new-tab').show();
                                                                document.getElementById("btn-start-recording").value="Start Recording";
                                                                button.innerHTML = 'Start Recording';
                                                                if(!button.disableStateWaiting) {
                                                                    button.disabled = false;
                                                                }
                                                            },
                                                            onMediaCapturingFailed: function(error) {
                                                                console.error('onMediaCapturingFailed:', error);
                                                                
                                                                if(error.toString().indexOf('no audio or video tracks available') !== -1) {
                                                                    alert('RecordRTC failed to start because there are no audio or video tracks available.');
                                                                }
                                                                
                                                                if(DetectRTC.browser.name === 'Safari') return;
                                                                
                                                                if(error.name === 'PermissionDeniedError' && DetectRTC.browser.name === 'Firefox') {
                                                                    alert('Firefox requires version >= 52. Firefox also requires HTTPs.');
                                                                }
                                                                
                                                                commonConfig.onMediaStopped();
                                                            }
                                                        };
                                                        
                                                        if(mediaContainerFormat.value === 'h264') {
                                                            mimeType = 'video/webm\;codecs=h264';
                                                            fileExtension = 'mp4';
                                                            
                                                            // video/mp4;codecs=avc1
                                                            if(isMimeTypeSupported('video/mpeg')) {
                                                                mimeType = 'video/mpeg';
                                                            }
                                                        }
                                                        
                                                        if(mediaContainerFormat.value === 'mkv' && isMimeTypeSupported('video/x-matroska;codecs=avc1')) {
                                                            mimeType = 'video/x-matroska;codecs=avc1';
                                                            fileExtension = 'mkv';
                                                        }
                                                        
                                                        if(mediaContainerFormat.value === 'vp8' && isMimeTypeSupported('video/webm\;codecs=vp8')) {
                                                            mimeType = 'video/webm\;codecs=vp8';
                                                            fileExtension = 'webm';
                                                            recorderType = null;
                                                            type = 'video';
                                                        }
                                                        
                                                        if(mediaContainerFormat.value === 'vp9' && isMimeTypeSupported('video/webm\;codecs=vp9')) {
                                                            mimeType = 'video/webm\;codecs=vp9';
                                                            fileExtension = 'webm';
                                                            recorderType = null;
                                                            type = 'video';
                                                        }
                                                        
                                                        if(mediaContainerFormat.value === 'pcm') {
                                                            mimeType = 'audio/wav';
                                                            fileExtension = 'wav';
                                                            recorderType = StereoAudioRecorder;
                                                            type = 'audio';
                                                        }
                                                        
                                                        if(mediaContainerFormat.value === 'opus' || mediaContainerFormat.value === 'ogg') {
                                                            if(isMimeTypeSupported('audio/webm')) {
                                                                mimeType = 'audio/webm';
                                                                fileExtension = 'webm'; // webm
                                                            }
                                                            
                                                            if(isMimeTypeSupported('audio/ogg')) {
                                                                mimeType = 'audio/ogg; codecs=opus';
                                                                fileExtension = 'ogg'; // ogg
                                                            }
                                                            
                                                            recorderType = null;
                                                            type = 'audio';
                                                        }
                                                        
                                                        if(mediaContainerFormat.value === 'whammy') {
                                                            mimeType = 'video/webm';
                                                            fileExtension = 'webm';
                                                            recorderType = WhammyRecorder;
                                                            type = 'video';
                                                        }
                                                        
                                                        if(mediaContainerFormat.value === 'gif') {
                                                            mimeType = 'image/gif';
                                                            fileExtension = 'gif';
                                                            recorderType = GifRecorder;
                                                            type = 'gif';
                                                        }
                                                        
                                                        if(mediaContainerFormat.value === 'default') {
                                                            mimeType = 'video/webm';
                                                            fileExtension = 'webm';
                                                            recorderType = null;
                                                            type = 'video';
                                                        }
                                                        
                                                        if(recordingMedia.value === 'record-audio') {
                                                            captureAudio(commonConfig);
                                                            
                                                            button.mediaCapturedCallback = function() {
                                                                var options = {
                                                                    type: type,
                                                                    mimeType: mimeType,
                                                                    leftChannel: params.leftChannel || false,
                                                                    disableLogs: params.disableLogs || false
                                                                };
                                                                
                                                                if(params.sampleRate) {
                                                                    options.sampleRate = parseInt(params.sampleRate);
                                                                }
                                                                
                                                                if(params.bufferSize) {
                                                                    options.bufferSize = parseInt(params.bufferSize);
                                                                }
                                                                
                                                                if(recorderType) {
                                                                    options.recorderType = recorderType;
                                                                }
                                                                
                                                                if(videoBitsPerSecond) {
                                                                    options.videoBitsPerSecond = videoBitsPerSecond;
                                                                }
                                                                
                                                                if(DetectRTC.browser.name === 'Edge') {
                                                                    options.numberOfAudioChannels = 1;
                                                                }
                                                                
                                                                options.ignoreMutedMedia = false;
                                                                button.recordRTC = RecordRTC(button.stream, options);
                                                                
                                                                button.recordingEndedCallback = function(url) {
                                                                    setVideoURL(url);
                                                                };
                                                                
                                                                button.recordRTC.startRecording();
                                                                
                                                            };
                                                        }
                                                        
                                                        if(recordingMedia.value === 'record-audio-plus-video') {
                                                            captureAudioPlusVideo(commonConfig);
                                                            
                                                            button.mediaCapturedCallback = function() {
                                                                if(typeof MediaRecorder === 'undefined') { // opera or chrome etc.
                                                                    button.recordRTC = [];
                                                                    
                                                                    if(!params.bufferSize) {
                                                                        // it fixes audio issues whilst recording 720p
                                                                        params.bufferSize = 16384;
                                                                    }
                                                                    
                                                                    var options = {
                                                                        type: 'audio', // hard-code to set "audio"
                                                                        leftChannel: params.leftChannel || false,
                                                                        disableLogs: params.disableLogs || false,
                                                                        video: recordingPlayer
                                                                    };
                                                                    
                                                                    if(params.sampleRate) {
                                                                        options.sampleRate = parseInt(params.sampleRate);
                                                                    }
                                                                    
                                                                    if(params.bufferSize) {
                                                                        options.bufferSize = parseInt(params.bufferSize);
                                                                    }
                                                                    
                                                                    if(params.frameInterval) {
                                                                        options.frameInterval = parseInt(params.frameInterval);
                                                                    }
                                                                    
                                                                    if(recorderType) {
                                                                        options.recorderType = recorderType;
                                                                    }
                                                                    
                                                                    if(videoBitsPerSecond) {
                                                                        options.videoBitsPerSecond = videoBitsPerSecond;
                                                                    }
                                                                    
                                                                    options.ignoreMutedMedia = false;
                                                                    var audioRecorder = RecordRTC(button.stream, options);
                                                                    
                                                                    options.type = type;
                                                                    var videoRecorder = RecordRTC(button.stream, options);
                                                                    
                                                                    // to sync audio/video playbacks in browser!
                                                                    videoRecorder.initRecorder(function() {
                                                                                               audioRecorder.initRecorder(function() {
                                                                                                                          audioRecorder.startRecording();
                                                                                                                          videoRecorder.startRecording();
                                                                                                                          
                                                                                                                          });
                                                                                               });
                                                                                               
                                                                                               button.recordRTC.push(audioRecorder, videoRecorder);
                                                                                               
                                                                                               button.recordingEndedCallback = function() {
                                                                                                   var audio = new Audio();
                                                                                                   audio.src = audioRecorder.toURL();
                                                                                                   audio.controls = true;
                                                                                                   audio.autoplay = true;
                                                                                                   
                                                                                                   recordingPlayer.parentNode.appendChild(document.createElement('hr'));
                                                                                                   recordingPlayer.parentNode.appendChild(audio);
                                                                                                   
                                                                                                   if(audio.paused) audio.play();
                                                                                               };
                                                                                               return;
                                                                }
                                                                
                                                                var options = {
                                                                    type: type,
                                                                    mimeType: mimeType,
                                                                    disableLogs: params.disableLogs || false,
                                                                    getNativeBlob: false, // enable it for longer recordings
                                                                    video: recordingPlayer
                                                                };
                                                                
                                                                if(recorderType) {
                                                                    options.recorderType = recorderType;
                                                                    
                                                                    if(recorderType == WhammyRecorder || recorderType == GifRecorder) {
                                                                        options.canvas = options.video = {
                                                                            width: defaultWidth || 320,
                                                                            height: defaultHeight || 240
                                                                        };
                                                                    }
                                                                }
                                                                
                                                                if(videoBitsPerSecond) {
                                                                    options.videoBitsPerSecond = videoBitsPerSecond;
                                                                }
                                                                
                                                                if(timeSlice && typeof MediaRecorder !== 'undefined') {
                                                                    options.timeSlice = timeSlice;
                                                                    button.blobs = [];
                                                                    options.ondataavailable = function(blob) {
                                                                        button.blobs.push(blob);
                                                                    };
                                                                }
                                                                
                                                                options.ignoreMutedMedia = false;
                                                                button.recordRTC = RecordRTC(button.stream, options);
                                                                
                                                                button.recordingEndedCallback = function(url) {
                                                                    setVideoURL(url);
                                                                };
                                                                
                                                                button.recordRTC.startRecording();
                                                                
                                                                recordingPlayer.parentNode.parentNode.querySelector('h2').innerHTML = '<img src="https://cdn.webrtc-experiment.com/images/progress.gif">';
                                                            };
                                                        }
                                                        
                                                        if(recordingMedia.value === 'record-screen') {
                                                            captureScreen(commonConfig);
                                                            
                                                            button.mediaCapturedCallback = function() {
                                                                var options = {
                                                                    type: type,
                                                                    mimeType: mimeType,
                                                                    disableLogs: params.disableLogs || false,
                                                                    getNativeBlob: false, // enable it for longer recordings
                                                                    video: recordingPlayer
                                                                };
                                                                
                                                                if(recorderType) {
                                                                    options.recorderType = recorderType;
                                                                    
                                                                    if(recorderType == WhammyRecorder || recorderType == GifRecorder) {
                                                                        options.canvas = options.video = {
                                                                            width: defaultWidth || 320,
                                                                            height: defaultHeight || 240
                                                                        };
                                                                    }
                                                                }
                                                                
                                                                if(videoBitsPerSecond) {
                                                                    options.videoBitsPerSecond = videoBitsPerSecond;
                                                                }
                                                                
                                                                options.ignoreMutedMedia = false;
                                                                button.recordRTC = RecordRTC(button.stream, options);
                                                                
                                                                button.recordingEndedCallback = function(url) {
                                                                    setVideoURL(url);
                                                                };
                                                                
                                                                button.recordRTC.startRecording();
                                                                
                                                            };
                                                        }
                                                        
                                                        // note: audio+tab is supported in Chrome 50+
                                                        // todo: add audio+tab recording
                                                        if(recordingMedia.value === 'record-audio-plus-screen') {
                                                            captureAudioPlusScreen(commonConfig);
                                                            
                                                            button.mediaCapturedCallback = function() {
                                                                var options = {
                                                                    type: type,
                                                                    mimeType: mimeType,
                                                                    disableLogs: params.disableLogs || false,
                                                                    getNativeBlob: false, // enable it for longer recordings
                                                                    video: recordingPlayer
                                                                };
                                                                
                                                                if(recorderType) {
                                                                    options.recorderType = recorderType;
                                                                    
                                                                    if(recorderType == WhammyRecorder || recorderType == GifRecorder) {
                                                                        options.canvas = options.video = {
                                                                            width: defaultWidth || 320,
                                                                            height: defaultHeight || 240
                                                                        };
                                                                    }
                                                                }
                                                                
                                                                if(videoBitsPerSecond) {
                                                                    options.videoBitsPerSecond = videoBitsPerSecond;
                                                                }
                                                                
                                                                options.ignoreMutedMedia = false;
                                                                button.recordRTC = RecordRTC(button.stream, options);
                                                                
                                                                button.recordingEndedCallback = function(url) {
                                                                    setVideoURL(url);
                                                                };
                                                                
                                                                button.recordRTC.startRecording();
                                                                
                                                            };
                                                        }
                                                    };
                                                    
                                                    function captureVideo(config) {
                                                        captureUserMedia({video: true}, function(videoStream) {
                                                                         config.onMediaCaptured(videoStream);
                                                                         
                                                                         addStreamStopListener(videoStream, function() {
                                                                                               config.onMediaStopped();
                                                                                               });
                                                                         }, function(error) {
                                                                         config.onMediaCapturingFailed(error);
                                                                         });
                                                    }
                                                    
                                                    function captureAudio(config) {
                                                        captureUserMedia({audio: true}, function(audioStream) {
                                                                         config.onMediaCaptured(audioStream);
                                                                         
                                                                         addStreamStopListener(audioStream, function() {
                                                                                               config.onMediaStopped();
                                                                                               });
                                                                         }, function(error) {
                                                                         config.onMediaCapturingFailed(error);
                                                                         });
                                                    }
                                                    
                                                    function captureAudioPlusVideo(config) {
                                                        captureUserMedia({video: true, audio: true}, function(audioVideoStream) {
                                                                         config.onMediaCaptured(audioVideoStream);
                                                                         
                                                                         if(audioVideoStream instanceof Array) {
                                                                         audioVideoStream.forEach(function(stream) {
                                                                                                  addStreamStopListener(stream, function() {
                                                                                                                        config.onMediaStopped();
                                                                                                                        });
                                                                                                  });
                                                                         return;
                                                                         }
                                                                         
                                                                         addStreamStopListener(audioVideoStream, function() {
                                                                                               config.onMediaStopped();
                                                                                               });
                                                                         }, function(error) {
                                                                         config.onMediaCapturingFailed(error);
                                                                         });
                                                    }
                                                    
                                                    var MY_DOMAIN = 'webrtc-experiment.com';
                                                    
                                                    function isMyOwnDomain() {
                                                        // replace "webrtc-experiment.com" with your own domain name
                                                        return document.domain.indexOf(MY_DOMAIN) !== -1;
                                                    }
                                                    
                                                    function isLocalHost() {
                                                        // "chrome.exe" --enable-usermedia-screen-capturing
                                                        // or firefox => about:config => "media.getusermedia.screensharing.allowed_domains" => add "localhost"
                                                        return document.domain === 'localhost' || document.domain === '127.0.0.1';
                                                    }
                                                    
                                                    function captureScreen(config) {
                                                        // Firefox screen capturing addon is open-sourced here: https://github.com/muaz-khan/Firefox-Extensions
                                                        // Google Chrome screen capturing extension is open-sourced here: https://github.com/muaz-khan/Chrome-Extensions/tree/master/desktopCapture
                                                        
                                                        window.getScreenId = function(chromeMediaSource, chromeMediaSourceId) {
                                                            var screenConstraints = {
                                                                audio: false,
                                                                video: {
                                                                    mandatory: {
                                                                        chromeMediaSourceId: chromeMediaSourceId,
                                                                        chromeMediaSource: isLocalHost() ? 'screen' : chromeMediaSource
                                                                    }
                                                                }
                                                            };
                                                            
                                                            if(DetectRTC.browser.name === 'Firefox') {
                                                                screenConstraints = {
                                                                    video: {
                                                                        mediaSource: 'window'
                                                                    }
                                                                }
                                                            }
                                                            
                                                            captureUserMedia(screenConstraints, function(screenStream) {
                                                                             config.onMediaCaptured(screenStream);
                                                                             
                                                                             addStreamStopListener(screenStream, function() {
                                                                                                   // config.onMediaStopped();
                                                                                                   
                                                                                                   btnStartRecording.onclick();
                                                                                                   });
                                                                             }, function(error) {
                                                                             config.onMediaCapturingFailed(error);
                                                                             
                                                                             if(isMyOwnDomain() === false && DetectRTC.browser.name === 'Chrome') {
                                                                             // otherwise deploy chrome extension yourselves
                                                                             // https://github.com/muaz-khan/Chrome-Extensions/tree/master/desktopCapture
                                                                             alert('Please enable this command line flag: "--enable-usermedia-screen-capturing"');
                                                                             }
                                                                             
                                                                             if(isMyOwnDomain() === false && DetectRTC.browser.name === 'Firefox') {
                                                                             // otherwise deploy firefox addon yourself
                                                                             // https://github.com/muaz-khan/Firefox-Extensions
                                                                             alert('Please enable screen capturing for your domain. Open "about:config" and search for "media.getusermedia.screensharing.allowed_domains"');
                                                                             }
                                                                             });
                                                        };
                                                        
                                                        if(DetectRTC.browser.name === 'Firefox' || isLocalHost()) {
                                                            window.getScreenId();
                                                        }
                                                        
                                                        window.postMessage('get-sourceId', '*');
                                                    }
                                                    
                                                    function captureAudioPlusScreen(config) {
                                                        // Firefox screen capturing addon is open-sourced here: https://github.com/muaz-khan/Firefox-Extensions
                                                        // Google Chrome screen capturing extension is open-sourced here: https://github.com/muaz-khan/Chrome-Extensions/tree/master/desktopCapture
                                                        
                                                        window.getScreenId = function(chromeMediaSource, chromeMediaSourceId) {
                                                            var screenConstraints = {
                                                                audio: false,
                                                                video: {
                                                                    mandatory: {
                                                                        chromeMediaSourceId: chromeMediaSourceId,
                                                                        chromeMediaSource: isLocalHost() ? 'screen' : chromeMediaSource
                                                                    }
                                                                }
                                                            };
                                                            
                                                            if(DetectRTC.browser.name === 'Firefox') {
                                                                screenConstraints = {
                                                                    video: {
                                                                        mediaSource: 'window'
                                                                    },
                                                                    audio: false
                                                                }
                                                            }
                                                            
                                                            captureUserMedia(screenConstraints, function(screenStream) {
                                                                             captureUserMedia({audio: true}, function(audioStream) {
                                                                                              var newStream = new MediaStream();
                                                                                              
                                                                                              // merge audio and video tracks in a single stream
                                                                                              audioStream.getAudioTracks().forEach(function(track) {
                                                                                                                                   newStream.addTrack(track);
                                                                                                                                   });
                                                                                              
                                                                                              screenStream.getVideoTracks().forEach(function(track) {
                                                                                                                                    newStream.addTrack(track);
                                                                                                                                    });
                                                                                              
                                                                                              config.onMediaCaptured(newStream);
                                                                                              
                                                                                              addStreamStopListener(newStream, function() {
                                                                                                                    config.onMediaStopped();
                                                                                                                    });
                                                                                              }, function(error) {
                                                                                              config.onMediaCapturingFailed(error);
                                                                                              });
                                                                             }, function(error) {
                                                                             config.onMediaCapturingFailed(error);
                                                                             
                                                                             if(isMyOwnDomain() === false && DetectRTC.browser.name === 'Chrome') {
                                                                             // otherwise deploy chrome extension yourselves
                                                                             // https://github.com/muaz-khan/Chrome-Extensions/tree/master/desktopCapture
                                                                             alert('Please enable this command line flag: "--enable-usermedia-screen-capturing"');
                                                                             }
                                                                             
                                                                             if(isMyOwnDomain() === false && DetectRTC.browser.name === 'Firefox') {
                                                                             // otherwise deploy firefox addon yourself
                                                                             // https://github.com/muaz-khan/Firefox-Extensions
                                                                             alert('Please enable screen capturing for your domain. Open "about:config" and search for "media.getusermedia.screensharing.allowed_domains"');
                                                                             }
                                                                             });
                                                        };
                                                        
                                                        if(DetectRTC.browser.name === 'Firefox' || isLocalHost()) {
                                                            window.getScreenId();
                                                        }
                                                        
                                                        window.postMessage('get-sourceId', '*');
                                                    }
                                                    
                                                    var videoBitsPerSecond;
                                                    
                                                    function setVideoBitrates() {
                                                        var select = document.querySelector('.media-bitrates');
                                                        var value = select.value;
                                                        
                                                        if(value == 'default') {
                                                            videoBitsPerSecond = null;
                                                            return;
                                                        }
                                                        
                                                        videoBitsPerSecond = parseInt(value);
                                                    }
                                                    
                                                    function getFrameRates(mediaConstraints) {
                                                        if(!mediaConstraints.video) {
                                                            return mediaConstraints;
                                                        }
                                                        
                                                        var select = document.querySelector('.media-framerates');
                                                        var value = select.value;
                                                        
                                                        if(value == 'default') {
                                                            return mediaConstraints;
                                                        }
                                                        
                                                        value = parseInt(value);
                                                        
                                                        if(DetectRTC.browser.name === 'Firefox') {
                                                            mediaConstraints.video.frameRate = value;
                                                            return mediaConstraints;
                                                        }
                                                        
                                                        if(!mediaConstraints.video.mandatory) {
                                                            mediaConstraints.video.mandatory = {};
                                                            mediaConstraints.video.optional = [];
                                                        }
                                                        
                                                        var isScreen = recordingMedia.value.toString().toLowerCase().indexOf('screen') != -1;
                                                        if(isScreen) {
                                                            mediaConstraints.video.mandatory.maxFrameRate = value;
                                                        }
                                                        else {
                                                            mediaConstraints.video.mandatory.minFrameRate = value;
                                                        }
                                                        
                                                        return mediaConstraints;
                                                    }
                                                    
                                                    function setGetFromLocalStorage(selectors) {
                                                        selectors.forEach(function(selector) {
                                                                          var storageItem = selector.replace(/\.|#/g, '');
                                                                          if(localStorage.getItem(storageItem)) {
                                                                          document.querySelector(selector).value = localStorage.getItem(storageItem);
                                                                          }
                                                                          
                                                                          addEventListenerToUploadLocalStorageItem(selector, ['change', 'blur'], function() {
                                                                                                                   localStorage.setItem(storageItem, document.querySelector(selector).value);
                                                                                                                   });
                                                                          });
                                                    }
                                                    
                                                    function addEventListenerToUploadLocalStorageItem(selector, arr, callback) {
                                                        arr.forEach(function(event) {
                                                                    document.querySelector(selector).addEventListener(event, callback, false);
                                                                    });
                                                    }
                                                    
                                                    setGetFromLocalStorage(['.media-resolutions', '.media-framerates', '.media-bitrates', '.recording-media', '.media-container-format']);
                                                    
                                                    function getVideoResolutions(mediaConstraints) {
                                                        if(!mediaConstraints.video) {
                                                            return mediaConstraints;
                                                        }
                                                        
                                                        var select = document.querySelector('.media-resolutions');
                                                        var value = select.value;
                                                        
                                                        if(value == 'default') {
                                                            return mediaConstraints;
                                                        }
                                                        
                                                        value = value.split('x');
                                                        
                                                        if(value.length != 2) {
                                                            return mediaConstraints;
                                                        }
                                                        
                                                        defaultWidth = parseInt(value[0]);
                                                        defaultHeight = parseInt(value[1]);
                                                        
                                                        if(DetectRTC.browser.name === 'Firefox') {
                                                            mediaConstraints.video.width = defaultWidth;
                                                            mediaConstraints.video.height = defaultHeight;
                                                            return mediaConstraints;
                                                        }
                                                        
                                                        if(!mediaConstraints.video.mandatory) {
                                                            mediaConstraints.video.mandatory = {};
                                                            mediaConstraints.video.optional = [];
                                                        }
                                                        
                                                        var isScreen = recordingMedia.value.toString().toLowerCase().indexOf('screen') != -1;
                                                        
                                                        if(isScreen) {
                                                            mediaConstraints.video.mandatory.maxWidth = defaultWidth;
                                                            mediaConstraints.video.mandatory.maxHeight = defaultHeight;
                                                        }
                                                        else {
                                                            mediaConstraints.video.mandatory.minWidth = defaultWidth;
                                                            mediaConstraints.video.mandatory.minHeight = defaultHeight;
                                                        }
                                                        
                                                        return mediaConstraints;
                                                    }
                                                    
                                                    function captureUserMedia(mediaConstraints, successCallback, errorCallback) {
                                                        if(mediaConstraints.video == true) {
                                                            mediaConstraints.video = {};
                                                        }
                                                        
                                                        setVideoBitrates();
                                                        
                                                        mediaConstraints = getVideoResolutions(mediaConstraints);
                                                        mediaConstraints = getFrameRates(mediaConstraints);
                                                        
                                                        var isBlackBerry = !!(/BB10|BlackBerry/i.test(navigator.userAgent || ''));
                                                        if(isBlackBerry && !!(navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia)) {
                                                            navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia;
                                                            navigator.getUserMedia(mediaConstraints, successCallback, errorCallback);
                                                            return;
                                                        }
                                                        
                                                        navigator.mediaDevices.getUserMedia(mediaConstraints).then(function(stream) {
                                                                                                                   successCallback(stream);
                                                                                                                   
                                                                                                                   setVideoURL(stream, true);
                                                                                                                   }).catch(function(error) {
                                                                                                                            if(error && error.name === 'ConstraintNotSatisfiedError') {
                                                                                                                            alert('Your camera or browser does NOT supports selected resolutions or frame-rates. \n\nPlease select "default" resolutions.');
                                                                                                                            }
                                                                                                                            
                                                                                                                            errorCallback(error);
                                                                                                                            });
                                                    }
                                                    
                                                    function setMediaContainerFormat(arrayOfOptionsSupported) {
                                                        var options = Array.prototype.slice.call(
                                                                                                 mediaContainerFormat.querySelectorAll('option')
                                                                                                 );
                                                                                                 
                                                                                                 var localStorageItem;
                                                                                                 if(localStorage.getItem('media-container-format')) {
                                                                                                     localStorageItem = localStorage.getItem('media-container-format');
                                                                                                 }
                                                                                                 
                                                                                                 var selectedItem;
                                                                                                 options.forEach(function(option) {
                                                                                                                 option.disabled = true;
                                                                                                                 
                                                                                                                 if(arrayOfOptionsSupported.indexOf(option.value) !== -1) {
                                                                                                                 option.disabled = false;
                                                                                                                 
                                                                                                                 if(localStorageItem && arrayOfOptionsSupported.indexOf(localStorageItem) != -1) {
                                                                                                                 if(option.value != localStorageItem) return;
                                                                                                                 option.selected = true;
                                                                                                                 selectedItem = option;
                                                                                                                 return;
                                                                                                                 }
                                                                                                                 
                                                                                                                 if(!selectedItem) {
                                                                                                                 option.selected = true;
                                                                                                                 selectedItem = option;
                                                                                                                 }
                                                                                                                 }
                                                                                                                 });
                                                    }
                                                    
                                                    function isMimeTypeSupported(mimeType) {
                                                        if(DetectRTC.browser.name === 'Edge' || DetectRTC.browser.name === 'Safari' || typeof MediaRecorder === 'undefined') {
                                                            return false;
                                                        }
                                                        
                                                        if(typeof MediaRecorder.isTypeSupported !== 'function') {
                                                            return true;
                                                        }
                                                        
                                                        return MediaRecorder.isTypeSupported(mimeType);
                                                    }
                                                    
                                                    recordingMedia.onchange = function() {
                                                        if(recordingMedia.value === 'record-audio') {
                                                            var recordingOptions = [];
                                                            
                                                            if(isMimeTypeSupported('audio/webm')) {
                                                                recordingOptions.push('opus');
                                                            }
                                                            
                                                            if(isMimeTypeSupported('audio/ogg')) {
                                                                recordingOptions.push('ogg');
                                                            }
                                                            
                                                            recordingOptions.push('pcm');
                                                            
                                                            setMediaContainerFormat(recordingOptions);
                                                            return;
                                                        }
                                                        
                                                        var isChrome = !!window.chrome && !(!!window.opera || navigator.userAgent.indexOf(' OPR/') >= 0);
                                                        
                                                        var recordingOptions = ['vp8']; // MediaStreamRecorder with vp8
                                                        
                                                        if(isMimeTypeSupported('video/webm\;codecs=vp9')) {
                                                            recordingOptions.push('vp9'); // MediaStreamRecorder with vp9
                                                        }
                                                        
                                                        if(isMimeTypeSupported('video/webm\;codecs=h264')) {
                                                            recordingOptions.push('h264'); // MediaStreamRecorder with h264
                                                        }
                                                        
                                                        if(isMimeTypeSupported('video/x-matroska;codecs=avc1')) {
                                                            recordingOptions.push('mkv'); // MediaStreamRecorder with mkv/matroska
                                                        }
                                                        
                                                        recordingOptions.push('gif'); // GifRecorder
                                                        
                                                        if(isChrome) {
                                                            recordingOptions.push('whammy'); // WhammyRecorder
                                                        }
                                                        
                                                        recordingOptions.push('default'); // Default mimeType for MediaStreamRecorder
                                                        
                                                        setMediaContainerFormat(recordingOptions);
                                                    };
                                                    recordingMedia.onchange();
                                                    
                                                    if(DetectRTC.browser.name === 'Edge' || DetectRTC.browser.name === 'Safari') {
                                                        // webp isn't supported in Microsoft Edge
                                                        // neither MediaRecorder API
                                                        // so lets disable both video/screen recording options
                                                        
                                                        console.warn('Neither MediaRecorder API nor webp is supported in ' + DetectRTC.browser.name + '. You cam merely record audio.');
                                                        
                                                        recordingMedia.innerHTML = '<option value="record-audio">Audio</option>';
                                                        setMediaContainerFormat(['pcm']);
                                                    }
                                                    
                                                    function stringify(obj) {
                                                        var result = '';
                                                        Object.keys(obj).forEach(function(key) {
                                                                                 if(typeof obj[key] === 'function') {
                                                                                 return;
                                                                                 }
                                                                                 
                                                                                 if(result.length) {
                                                                                 result += ',';
                                                                                 }
                                                                                 
                                                                                 result += key + ': ' + obj[key];
                                                                                 });
                                                                                 
                                                                                 return result;
                                                    }
                                                    
                                                    function mediaRecorderToStringify(mediaRecorder) {
                                                        var result = '';
                                                        result += 'mimeType: ' + mediaRecorder.mimeType;
                                                        result += ', state: ' + mediaRecorder.state;
                                                        result += ', audioBitsPerSecond: ' + mediaRecorder.audioBitsPerSecond;
                                                        result += ', videoBitsPerSecond: ' + mediaRecorder.videoBitsPerSecond;
                                                        if(mediaRecorder.stream) {
                                                            result += ', streamid: ' + mediaRecorder.stream.id;
                                                            result += ', stream-active: ' + mediaRecorder.stream.active;
                                                        }
                                                        return result;
                                                    }
                                                    
                                                    function getFailureReport() {
                                                        var info = 'RecordRTC seems failed. \n\n' + stringify(DetectRTC.browser) + '\n\n' + DetectRTC.osName + ' ' + DetectRTC.osVersion + '\n';
                                                        
                                                        if (typeof recorderType !== 'undefined' && recorderType) {
                                                            info += '\nrecorderType: ' + recorderType.name;
                                                        }
                                                        
                                                        if (typeof mimeType !== 'undefined') {
                                                            info += '\nmimeType: ' + mimeType;
                                                        }
                                                        
                                                        Array.prototype.slice.call(document.querySelectorAll('select')).forEach(function(select) {
                                                                                                                                info += '\n' + (select.id || select.className) + ': ' + select.value;
                                                                                                                                });
                                                                                                                                
                                                                                                                                if (btnStartRecording.recordRTC) {
                                                                                                                                    info += '\n\ninternal-recorder: ' + btnStartRecording.recordRTC.getInternalRecorder().name;
                                                                                                                                    
                                                                                                                                    if(btnStartRecording.recordRTC.getInternalRecorder().getAllStates) {
                                                                                                                                        info += '\n\nrecorder-states: ' + btnStartRecording.recordRTC.getInternalRecorder().getAllStates();
                                                                                                                                    }
                                                                                                                                }
                                                                                                                                
                                                                                                                                if(btnStartRecording.stream) {
                                                                                                                                    info += '\n\naudio-tracks: ' + btnStartRecording.stream.getAudioTracks().length;
                                                                                                                                    info += '\nvideo-tracks: ' + btnStartRecording.stream.getVideoTracks().length;
                                                                                                                                    info += '\nstream-active? ' + !!btnStartRecording.stream.active;
                                                                                                                                    
                                                                                                                                    btnStartRecording.stream.getAudioTracks().concat(btnStartRecording.stream.getVideoTracks()).forEach(function(track) {
                                                                                                                                                                                                                                        info += '\n' + track.kind + '-track-' + (track.label || track.id) + ': (enabled: ' + !!track.enabled + ', readyState: ' + track.readyState + ', muted: ' + !!track.muted + ')';
                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                        if(track.getConstraints && Object.keys(track.getConstraints()).length) {
                                                                                                                                                                                                                                        info += '\n' + track.kind + '-track-getConstraints: ' + stringify(track.getConstraints());
                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                        if(track.getSettings && Object.keys(track.getSettings()).length) {
                                                                                                                                                                                                                                        info += '\n' + track.kind + '-track-getSettings: ' + stringify(track.getSettings());
                                                                                                                                                                                                                                        }
                                                                                                                                                                                                                                        });
                                                                                                                                }
                                                                                                                                
                                                                                                                                if(timeSlice && btnStartRecording.recordRTC) {
                                                                                                                                    info += '\ntimeSlice: ' + timeSlice;
                                                                                                                                    
                                                                                                                                    if(btnStartRecording.recordRTC.getInternalRecorder().getArrayOfBlobs) {
                                                                                                                                        var blobSizes = [];
                                                                                                                                        btnStartRecording.recordRTC.getInternalRecorder().getArrayOfBlobs().forEach(function(blob) {
                                                                                                                                                                                                                    blobSizes.push(blob.size);
                                                                                                                                                                                                                    });
                                                                                                                                                                                                                    info += '\nblobSizes: ' + blobSizes;
                                                                                                                                    }
                                                                                                                                }
                                                                                                                                
                                                                                                                                else if(btnStartRecording.recordRTC && btnStartRecording.recordRTC.getBlob()) {
                                                                                                                                    info += '\n\nblobSize: ' + bytesToSize(btnStartRecording.recordRTC.getBlob().size);
                                                                                                                                }
                                                                                                                                
                                                                                                                                if(btnStartRecording.recordRTC && btnStartRecording.recordRTC.getInternalRecorder() && btnStartRecording.recordRTC.getInternalRecorder().getInternalRecorder && btnStartRecording.recordRTC.getInternalRecorder().getInternalRecorder()) {
                                                                                                                                    info += '\n\ngetInternalRecorder: ' + mediaRecorderToStringify(btnStartRecording.recordRTC.getInternalRecorder().getInternalRecorder());
                                                                                                                                }
                                                                                                                                
                                                                                                                                return info;
                                                    }
                                                    
                                                    function saveToDiskOrOpenNewTab(recordRTC) {
                                                        saveImageOnServer();
                                                        if(!recordRTC.getBlob().size) {
                                                            var info = getFailureReport();
                                                            console.log('blob', recordRTC.getBlob());
                                                            console.log('recordrtc instance', recordRTC);
                                                            console.log('report', info);
                                                            
                                                            if(mediaContainerFormat.value !== 'default') {
                                                                alert('RecordRTC seems failed recording using ' + mediaContainerFormat.value + '. Please choose "default" option from the drop down and record again.');
                                                            }
                                                            else {
                                                                alert('RecordRTC seems failed. Unexpected issue. You can read the email in your console log. \n\nPlease report using disqus chat below.');
                                                            }
                                                            
                                                            if(mediaContainerFormat.value !== 'vp9' && DetectRTC.browser.name === 'Chrome') {
                                                                alert('Please record using VP9 encoder. (select from the dropdown)');
                                                            }
                                                        }
                                                        
                                                        var fileName = getFileName(fileExtension);
                                                        
                                                        
                                                        document.querySelector('#save-to-disk').onclick = function(event) {
                                                            if(!recordRTC) return alert('No recording found.');
                                                            
                                                            var file = new File([recordRTC.getBlob()], fileName, {
                                                                                type: mimeType
                                                                                });
                                                                                saveImageOnServer(file);
                                                                                /*     invokeSaveAsDialog(file, '${userFullName}'); */
                                                                                
                                                        };
                                                        
                                                        document.querySelector('#open-new-tab').onclick = function() {
                                                            var file = new File([recordRTC.getBlob()], fileName, {type: mimeType});
                                                            var videoPreview = document.getElementById('playvideo');
                                                            videoPreview.style.display="block";
                                                            videoPreview.src = window.URL.createObjectURL(file);
                                                            videoPreview.play();
                                                            /* window.location.replace(URL.createObjectURL(file)); */
                                                        };
                                                        
                                                        function saveImageOnServer(){
                                                        }
                                                        
                                                        
                                                    }
                                                    
                                                    /*
                                                     
                                                     
                                                     
                                                     function getRandomString() {
                                                     if (window.crypto && window.crypto.getRandomValues && navigator.userAgent.indexOf('Safari') === -1) {
                                                     var a = window.crypto.getRandomValues(new Uint32Array(3)),
                                                     token = '';
                                                     for (var i = 0, l = a.length; i < l; i++) {
                                                     token += a[i].toString(36);
                                                     }
                                                     return token;
                                                     } else {
                                                     return (Math.random() * new Date().getTime()).toString(36).replace(/\./g, '');
                                                     }
                                                     } */
                                                    
                                                    function getFileName(fileExtension) {
                                                        var d = new Date();
                                                        var year = d.getUTCFullYear();
                                                        var month = d.getUTCMonth();
                                                        var date = d.getUTCDate();
                                                        var finalDate = date+'.'+(month+1)+'.'+year;
                                                        return  finalDate+ '.' + fileExtension;
                                                    }
                                                    
                                                    function SaveFileURLToDisk(fileUrl, fileName) {
                                                        var hyperlink = document.createElement('a');
                                                        hyperlink.href = fileUrl;
                                                        hyperlink.target = '_blank';
                                                        hyperlink.download = fileName || fileUrl;
                                                        
                                                        (document.body || document.documentElement).appendChild(hyperlink);
                                                        hyperlink.onclick = function() {
                                                            (document.body || document.documentElement).removeChild(hyperlink);
                                                            
                                                            // required for Firefox
                                                            window.URL.revokeObjectURL(hyperlink.href);
                                                        };
                                                        
                                                        var mouseEvent = new MouseEvent('click', {
                                                                                        view: window,
                                                                                        bubbles: true,
                                                                                        cancelable: true
                                                                                        });
                                                                                        
                                                                                        hyperlink.dispatchEvent(mouseEvent);
                                                    }
                                                    
                                                    function getURL(arg) {
                                                        var url = arg;
                                                        
                                                        if(arg instanceof Blob || arg instanceof File) {
                                                            url = URL.createObjectURL(arg);
                                                        }
                                                        
                                                        if(arg instanceof RecordRTC || arg.getBlob) {
                                                            url = URL.createObjectURL(arg.getBlob());
                                                        }
                                                        
                                                        if(arg instanceof MediaStream || arg.getTracks || arg.getVideoTracks || arg.getAudioTracks) {
                                                            // url = URL.createObjectURL(arg);
                                                        }
                                                        
                                                        return url;
                                                    }
                                                    
                                                    function setVideoURL(arg, forceNonImage) {
                                                        var url = getURL(arg);
                                                        
                                                        var parentNode = recordingPlayer.parentNode;
                                                        parentNode.removeChild(recordingPlayer);
                                                        parentNode.innerHTML = '';
                                                        
                                                        var elem = 'video';
                                                        if(type == 'gif' && !forceNonImage) {
                                                            elem = 'img';
                                                        }
                                                        if(type == 'audio') {
                                                            elem = 'audio';
                                                        }
                                                        
                                                        recordingPlayer = document.createElement(elem);
                                                        
                                                        if(arg instanceof MediaStream) {
                                                            recordingPlayer.muted = true;
                                                        }
                                                        
                                                        recordingPlayer.addEventListener('loadedmetadata', function() {
                                                                                         if(navigator.userAgent.toLowerCase().indexOf('android') == -1) return;
                                                                                         
                                                                                         // android
                                                                                         setTimeout(function() {
                                                                                                    if(typeof recordingPlayer.play === 'function') {
                                                                                                    recordingPlayer.play();
                                                                                                    }
                                                                                                    }, 2000);
                                                                                         }, false);
                                                                                         
                                                                                         recordingPlayer.poster = '';
                                                                                         
                                                                                         if(arg instanceof MediaStream) {
                                                                                             recordingPlayer.srcObject = arg;
                                                                                         }
                                                                                         else {
                                                                                             recordingPlayer.src = url;
                                                                                         }
                                                                                         
                                                                                         if(typeof recordingPlayer.play === 'function') {
                                                                                             recordingPlayer.play();
                                                                                         }
                                                                                         
                                                                                         recordingPlayer.addEventListener('ended', function() {
                                                                                                                          url = getURL(arg);
                                                                                                                          
                                                                                                                          if(arg instanceof MediaStream) {
                                                                                                                          recordingPlayer.srcObject = arg;
                                                                                                                          }
                                                                                                                          else {
                                                                                                                          recordingPlayer.src = url;
                                                                                                                          }
                                                                                                                          });
                                                                                                                          
                                                                                                                          parentNode.appendChild(recordingPlayer);
                                                    }
                                                    </script>
                                                    
                                                    
                                                    
                                                    <script>
                                                        var chkTimeSlice = document.querySelector('#chk-timeSlice');
                                                        var timeSlice = false;
                                                        
                                                        if(typeof MediaRecorder === 'undefined') {
                                                            chkTimeSlice.disabled = true;
                                                        }
                                                    
                                                    chkTimeSlice.addEventListener('change', function() {
                                                                                  if(chkTimeSlice.checked === true) {
                                                                                  var _timeSlice = prompt('Please enter timeSlice in milliseconds e.g. 1000 or 2000 or 3000.', 1000);
                                                                                  _timeSlice = parseInt(_timeSlice);
                                                                                  if(!_timeSlice || _timeSlice == NaN || typeof _timeSlice === 'undefined') {
                                                                                  timeSlice = false;
                                                                                  return;
                                                                                  }
                                                                                  
                                                                                  timeSlice = _timeSlice;
                                                                                  }
                                                                                  else {
                                                                                  timeSlice = false;
                                                                                  }
                                                                                  }, false);
                                                        </script>
                                                    
                                                    
                                                </article>
                                                
                                                <!-- commits.js is useless for you! -->
                                                <script>
                                                    window.useThisGithubPath = 'muaz-khan/RecordRTC';
                                                    </script>
                                                
                                                <script>
                                                    var chromeMediaSource = 'screen';
                                                    window.addEventListener('message', function(message) {
                                                                            if(message.origin.toString().indexOf(MY_DOMAIN) === -1) return;
                                                                            chromeMediaSource = 'desktop';
                                                                            if(typeof getScreenId == 'function' && !!message.data.sourceId) {
                                                                            getScreenId(chromeMediaSource, message.data.sourceId);
                                                                            }
                                                                            });
                                                    </script>
                                                </td>
                                 
                                                </tr>
                                               
                                                
                                                </table>
                                                
                                                </div>
                                                </td>
                                                </tr>
                                                </tbody>
                                                </table>
                                                <div style="display: none;"><pre id="audioCtrlMsg"></pre></div>
                        
                        
</html>
